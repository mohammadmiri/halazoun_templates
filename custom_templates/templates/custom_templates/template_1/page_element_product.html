{% load static %}

<div class="product-wrapper">
    <div class="info row">
        <div class="gallery col-md-6 p-5">
            <div id="carouselExampleIndicators" class="carousel slide" data-ride="carousel">
                <ol class="carousel-indicators">
                    <li data-target="#carouselExampleIndicators" data-slide-to="0" class="active"></li>
                    <li data-target="#carouselExampleIndicators" data-slide-to="1"></li>
                    <li data-target="#carouselExampleIndicators" data-slide-to="2"></li>
                </ol>
                <div class="carousel-inner rounded">
                    <div class="carousel-item active">
                        <img class="d-block w-100" src="{% static 'custom_templates/img/slider-images/cS-1.jpg' %}" alt="First slide">
                    </div>
                    <div class="carousel-item">
                        <img class="d-block w-100" src="{% static 'custom_templates/img/slider-images/cS-2.jpg' %}" alt="Second slide">
                    </div>
                    <div class="carousel-item">
                        <img class="d-block w-100" src="{% static 'custom_templates/img/slider-images/cS-3.jpg' %}" alt="Third slide">
                    </div>
                </div>
                <a class="carousel-control-prev" href="#carouselExampleIndicators" role="button" data-slide="prev">
                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                    <span class="sr-only">Previous</span>
                </a>
                <a class="carousel-control-next" href="#carouselExampleIndicators" role="button" data-slide="next">
                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                    <span class="sr-only">Next</span>
                </a>
            </div>
        </div>

        <div class="product-detail col-md-6 p-5">
            <div class="text-center m-3 h5">
                <a href="">صفحه‌ی اصلی</a>
                /
                <a href="">دسته‌بندی</a>
            </div>
            <div class="text-center m-4 h3 font-weight-bold">کتاب آموزش آشپزی ایرانی</div>
            <div class="text-center text-danger m-3">ناموجود</div>
            <div class="d-flex justify-content-center p-3"><div class="btn btn-success" id="add_to_shopping_cart">
                افزودن به سبد خرید
            </div></div>
            <div class="text-justify">
                اگر در این روزها به فکر هدیه دادن به افرادی که دوستشان دارید هستید باید بدانید این پکیج لازم و ملزوم هر خانه و آشپزخانه ای است.
پکیج با 10% تخفیف حاوی 2 جلد کتاب آشپزی ایرانی هر استان به روایت سانازمینایی, رازورمزها ونکات و تکنیک صحیح آشپزی ایرانی, نوآوری در عطر و طعم دستپخت ایرانی به همراه سی دی آموزشی مرحله به مرحله و یک جلد کتاب نکته و تکنیک آشپزی است که آنچه می بایست از خرید و نگهداری , ترکیب طعم ها و روشهای پخت , انواع برش و..... بدانید در آن وجود دارد.
            </div>
        </div>
    </div>

    <div class="similar-products">
        <div id="carousel-example-multi" class="carousel slide carousel-multi-item v-2" data-ride="carousel">

            <!-- related products -->
            <div class="related-products-wrapper container pb-5">
                <div class="row">
                    <div class="text-right pr-3">
                        <h5>محصولات مشابه</h5>
                    </div>
                </div>
                <div class="row products-wrapper">
                    <div class="col-md-3 col-sm-12 pb-2">
                        <div class="product-wrapper">
                            <div class="product-image text-center pt-3 pb-3">
                                <img src="{% static 'custom_templates/img/slider-images/cS-3.jpg' %}">
                            </div>
                            <div class="product-name d-block text-center">
                                کالای دیگر
                            </div>
                            <div class="product-base-price text-center">
                                <del>2140</del>
                            </div>
                            <div class="product-discount-price text-center pb-3">
                                <span>2140</span><span>تومان</span>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3 col-sm-12 pb-2">
                        <div class="product-wrapper">
                            <div class="product-image text-center pt-3 pb-3">
                                <img src="{% static 'custom_templates/img/slider-images/cS-1.jpg' %}">
                            </div>
                            <div class="product-name d-block text-center">
                                کالای دیگر
                            </div>
                            <div class="product-base-price text-center">
                                <del>2140</del>
                            </div>
                            <div class="product-discount-price text-center pb-3">
                                <span>2140</span><span>تومان</span>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3 col-sm-12 pb-2">
                        <div class="product-wrapper">
                            <div class="product-image text-center pt-3 pb-3">
                                <img src="{% static 'custom_templates/img/slider-images/cS-4.jpg' %}">
                            </div>
                            <div class="product-name d-block text-center">
                                کالای دیگر
                            </div>
                            <div class="product-base-price text-center">
                                <del>2140</del>
                            </div>
                            <div class="product-discount-price text-center pb-3">
                                <span>2140</span><span>تومان</span>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3 col-sm-12 pb-2">
                        <div class="product-wrapper">
                            <div class="product-image text-center pt-3 pb-3">
                                <img src="{% static 'custom_templates/img/slider-images/cS-5.jpg' %}">
                            </div>
                            <div class="product-name d-block text-center">
                                کالای دیگر
                            </div>
                            <div class="product-base-price text-center">
                                <del>2140</del>
                            </div>
                            <div class="product-discount-price text-center pb-3">
                                <span>2140</span><span>تومان</span>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3 col-sm-12  pb-2">
                        <div class="product-wrapper">
                            <div class="product-image text-center pt-3 pb-3">
                                <img src="{% static 'custom_templates/img/slider-images/cS-6.jpg' %}">
                            </div>
                            <div class="product-name d-block text-center">
                                کالای دیگر
                            </div>
                            <div class="product-base-price text-center">
                                <del>2140</del>
                            </div>
                            <div class="product-discount-price text-center pb-3">
                                <span>2140</span><span>تومان</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- end of related products -->

            <!-- comment -->
            <div class="comments-wrapper container pb-5" id="comments-wrapper">
                <div class="text-right">
                    نظرات:
                </div>
                <div class="body">
                </div>
            </div>
            <form action="shop/add_comments" method="post" id="comment-form">
                <div class="write-comment-wrapper container form-group">
                    <div class="row">
                        <div class="col-md-4 col-sm-12 col-xs-12 p-2">
                            <div class="title text-right">
                                نام
                            </div>
                            <div class="input w-100">
                                <input name="name" placeholder="اختیاری" class="form-control">
                            </div>
                        </div>
                        <div class="col-md-4 col-sm-12 p-2">
                            <div class="title text-right">
                              ایمیل
                            </div>
                            <div class="input w-100">
                                <input name="email" placeholder="اختیاری" class="form-control">
                            </div>
                        </div>
                        <div class="col-md-4 col-sm-12 p-2">
                            <div class="title text-right">
                                شماره موبایل
                            </div>
                            <div class="input">
                                <input name="mobile-number" placeholder="اختیاری" class="form-control">
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12 col-sm-12">
                            <textarea name="text" class="form-control w-100" placeholder="نظر" rows="10"></textarea>
                        </div>
                    </div>
                    <div class="row mt-3 pr-3">
                        <button class="btn btn-success white" type="submit">ارسال</button>
                    </div>
                </div>
            </form>
            <!-- end of comment -->

        </div>
    </div>

</div>


<style>

    .related-products-wrapper .products-wrapper .product-wrapper{
        border: solid 1px rgba(9, 9, 9, 0.2);
        border-radius: 5px;
    }
    .related-products-wrapper .products-wrapper .product-image img{
        max-width: 200px;
        max-height: 200px;
    }

    .comments-wrapper .comment-wrapper{
        border: solid 1px rgba(9, 9, 9, 0.3);
        border-radius: 4px;
    }
    .comments-wrapper .comment-wrapper .comment{

    }
    .comments-wrapper .comment-wrapper .reply{

    }
    .hidden-item{
        display: none;
    }

</style>

<script>

    $(document).ready(function(){
        let base_url = 'http://127.0.0.1:8000/';
        let shoppping_cart_session_key = 'shopping_cart_session';

        $('#add_to_shopping_cart').click(function(event){
            let data = {
                'shop_name': get_shop_name(),
                'product_id': get_product_id(),
                'amount': 1
            };

            if(localStorage.getItem(shoppping_cart_session_key)){
                let shopping_cart_session = localStorage.getItem(shoppping_cart_session_key);
                data['session'] = shopping_cart_session;
            }

            $.ajax({
            url: base_url+'shop/customer/add_to_shopping_cart/',
            data: data,
            type: 'POST',
            datatype: "json",
            cache: false,
            traditional: true,
            header: {},
            success: function (data,  textStatus, xhr) {
                if(xhr.status < 400){
                    localStorage.setItem(shoppping_cart_session_key, JSON.parse(data['session']));
                }
            },
            error: function (xhr, status, error) {
                console.log('error ', error);
            }});
        });

        fetch_comments(base_url);
        $('#comment-form').attr({'action': base_url+'shop/customer/add_comment/'+get_product_id()})

    });

    function get_product_id(){
        return '19'
    }

    function get_shop_name(){
        return 'bamilo';
    }

    function fetch_comments(base_url){
        url = base_url+'shop/customer/list_comments_of_products/'+get_product_id();
        $.ajax({
            url: url,
            data: {},
            type: 'GET',
            datatype: "json",
            cache: false,
            traditional: true,
            header: {},
            success: function (data,  textStatus, xhr) {
                if(xhr.status < 400){
                    console.log(data);
                    add_comments(data);
                }
            },
            error: function (xhr, status, error) {
                console.log('error ', error);
            }}
        );

        function add_comments(comments){
            let comment_element_string = '<div class="comment-wrapper pb-2 mt-3">'+
                        '<div class="comment p-3" dir="rtl">'+
                            '<div class="name font-weight-bold text-right">'+
                            '</div>'+
                            '<div class="text text-right">'+
                            '</div>'+
                        '</div>'+
                        '<div class="reply pr-5">'+
                            '<div class="name font-weight-bold text-right">'+
                            'جواب ادمین:'+
                            '</div>'+
                            '<div class="text text-right">'+
                            '</div>'+
                        '</div>'+
                    '</div>';
            for(let i=0; i<comments.length; i++){
                let comment_element = $(comment_element_string);
                comment_element.find('.comment .name').text(comments[i]['name']+':');
                comment_element.find('.comment .text').text(comments[i]['text']);
                comment_element.find('.reply .text').text(comments[i]['reply']);
                if(comments[i]['reply'] == '' || comments[i]['reply'] == undefined ){
                    comment_element.find('.reply').addClass('hidden-item');
                }
                $('#comments-wrapper').append(comment_element);
            }
        }
    }

</script>
